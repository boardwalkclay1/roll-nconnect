<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Longboard Chat – Roll ’n Connect</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="../rc_global.css">
</head>

<body>

  <div class="stars1"></div>
  <div class="stars2"></div>
  <div class="stars3"></div>

  <div class="rc-app">

    <aside class="rc-sidebar">
      <div class="rc-logo">Roll ’n Connect</div>
      <nav class="rc-nav">
        <button onclick="location.href='../dashboard.html'">Dashboard</button>
        <button onclick="location.href='../events.html'">Events</button>
        <button onclick="location.href='../find-spots.html'">Find Spots</button>
        <button class="rc-active">Chatrooms</button>
        <button onclick="location.href='../profile.html'">Your Profile</button>
        <button onclick="location.href='../profile-edit.html'">Edit Profile</button>
        <button onclick="location.href='../marketplace.html'">Marketplace</button>
      </nav>
    </aside>

    <main class="rc-content" data-discipline="longboard">

      <section class="rc-section rc-active">

        <div class="rc-card" title="This lobby shows all public and user-created rooms for this discipline.">
          <h2 id="disciplineTitle">Longboard Chat</h2>
          <p class="rc-muted" id="disciplineDesc">
            Flow, dancing, cruising, downhill, and freestyle — choose a room or create your own.
          </p>
        </div>

        <div class="rc-card" title="These are the main public rooms for this discipline.">
          <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px;">
            <h3>Public Rooms</h3>
            <span class="rc-muted" style="font-size:12px;">Tap a room to enter chat.</span>
          </div>
          <div id="publicRooms" class="rc-list-grid"></div>
        </div>

        <div class="rc-card" title="Create your own room inside this discipline. Only people with the link can join.">
          <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px;">
            <h3>Your Rooms</h3>
            <button class="rc-btn" id="createRoomBtn">+ Create Room</button>
          </div>
          <div class="rc-muted" style="font-size:12px;margin-bottom:8px;">
            These rooms are created by you and other skaters in this discipline.
          </div>
          <div id="userRooms" class="rc-list-grid"></div>
        </div>

        <div class="rc-card" title="Join live voice rooms to talk in real time.">
          <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px;">
            <h3>Live Voice Rooms</h3>
            <span class="rc-muted" style="font-size:12px;">Join a live voice session.</span>
          </div>
          <div id="voiceRooms" class="rc-list-grid"></div>
        </div>

      </section>

    </main>

  </div>

  <script src="../rc_core.js"></script>
  <script src="../js/rc_chatrooms_config.js"></script>

  <script>
    const disciplineKey = document.querySelector("main").dataset.discipline;
    const config = window.RC_CHATROOMS[disciplineKey];

    const publicEl = document.getElementById("publicRooms");
    const userEl = document.getElementById("userRooms");
    const voiceEl = document.getElementById("voiceRooms");

    function getUserRooms() {
      try {
        const all = JSON.parse(localStorage.getItem("rc_user_rooms") || "{}");
        return all[disciplineKey] || [];
      } catch (e) {
        return [];
      }
    }

    function saveUserRooms(rooms) {
      const all = JSON.parse(localStorage.getItem("rc_user_rooms") || "{}");
      all[disciplineKey] = rooms;
      localStorage.setItem("rc_user_rooms", JSON.stringify(all));
    }

    function renderPublicRooms() {
      if (!config || !config.rooms || !config.rooms.length) {
        publicEl.innerHTML = "<p class='rc-muted'>No public rooms defined.</p>";
        return;
      }
      publicEl.innerHTML = config.rooms.map(r => `
        <button class="rc-list-item"
                title="Enter this room to chat, send emojis, and voice messages."
                onclick="enterRoom('${disciplineKey}','${r.id}','public')">
          <div>
            <div class="rc-list-title">${r.name}</div>
            <div class="rc-list-sub">Public • ${config.name}</div>
          </div>
        </button>
      `).join("");
    }

    function renderUserRooms() {
      const rooms = getUserRooms();
      if (!rooms.length) {
        userEl.innerHTML = "<p class='rc-muted'>No rooms yet. Create one.</p>";
        return;
      }
      userEl.innerHTML = rooms.map(r => `
        <button class="rc-list-item"
                title="Your custom room. Share the link so others can join."
                onclick="enterRoom('${disciplineKey}','${r.id}','user')">
          <div>
            <div class="rc-list-title">${r.name}</div>
            <div class="rc-list-sub">User-created • ${config.name}</div>
          </div>
        </button>
      `).join("");
    }

    function renderVoiceRooms() {
      if (!config || !config.voice || !config.voice.length) {
        voiceEl.innerHTML = "<p class='rc-muted'>No live voice rooms yet.</p>";
        return;
      }
      voiceEl.innerHTML = config.voice.map(v => `
        <button class="rc-list-item"
                title="Join this live voice room to talk in real time."
                onclick="enterRoom('${disciplineKey}','${v.id}','voice')">
          <div>
            <div class="rc-list-title">${v.name}</div>
            <div class="rc-list-sub">Live voice • ${config.name}</div>
          </div>
        </button>
      `).join("");
    }

    function createRoom() {
      const name = prompt("Room name?");
      if (!name) return;
      const rooms = getUserRooms();
      const id = "user_room_" + Date.now();
      rooms.push({ id, name, type: "user" });
      saveUserRooms(rooms);
      renderUserRooms();
    }

    function enterRoom(discipline, roomId, roomType) {
      const url = `rooms/room.html?discipline=${encodeURIComponent(discipline)}&room=${encodeURIComponent(roomId)}&type=${encodeURIComponent(roomType)}`;
      location.href = url;
    }

    document.getElementById("createRoomBtn").onclick = createRoom;

    renderPublicRooms();
    renderUserRooms();
    renderVoiceRooms();
  </script>

</body>
</html>
