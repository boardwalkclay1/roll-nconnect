<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>My Listings â€” Roll â€™n Connect</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="rc_global.css">
</head>
<body>

<div class="stars1"></div><div class="stars2"></div><div class="stars3"></div>

<div class="hamburger" id="hamburger"><span></span><span></span><span></span></div>
<div class="sidebar" id="sidebar">
  <h2>Menu</h2>
  <a href="index.html">Home</a>
  <a href="marketplace.html">Marketplace</a>
  <a href="profile.html">Your Profile</a>
</div>

<div class="wrapper" style="padding:24px;">
  <div class="glass" style="padding:24px;">
    <h1 class="section-title">My Listings</h1>
    <a href="marketplace-create.html" class="btn-primary" style="margin-top:8px;">+ Create Listing</a>

    <div id="myListings" class="market-grid" style="margin-top:16px;"></div>
  </div>
</div>

<script src="rc_core.js"></script>
<script src="js/rc_market_core.js"></script>
<script>
  document.getElementById("hamburger").onclick = () => {
    document.getElementById("hamburger").classList.toggle("active");
    document.getElementById("sidebar").classList.toggle("open");
  };

  document.addEventListener("DOMContentLoaded", () => {
    const core = window.RC_MARKET_CORE;
    const me = core.getCurrentUser();
    const listEl = document.getElementById("myListings");

    const items = core.getListingsBySeller(me.id);
    if (!items.length) {
      listEl.innerHTML = "<p style='opacity:0.7;'>You haven't posted any listings yet.</p>";
      return;
    }

    listEl.innerHTML = items.map(item => `
      <div class="market-card">
        <div onclick="window.location.href='marketplace-item.html?id=${item.id}'">
          ${(item.photos && item.photos.length)
            ? `<img src="${item.photos[0]}" style="width:100%;height:140px;object-fit:cover;border-radius:12px;">`
            : `<div style="width:100%;height:140px;border-radius:12px;background:rgba(255,255,255,0.06);display:flex;align-items:center;justify-content:center;font-size:32px;opacity:0.6;">ðŸ›¼</div>`
          }
          <div style="margin-top:8px;">
            <strong>${item.title}</strong><br>
            <span style="opacity:0.8;font-size:13px;">${item.category}${item.spotName ? " â€¢ " + item.spotName : ""}</span>
            <div style="margin-top:6px;font-weight:600;">${core.formatPrice(item.price, item.currency)}</div>
          </div>
        </div>
        <div style="margin-top:8px;display:flex;gap:6px;">
          <button class="btn-small" onclick="editListing('${item.id}')">Edit</button>
          <button class="btn-small" onclick="deleteListing('${item.id}')">Delete</button>
        </div>
      </div>
    `).join("");

    window.editListing = (id) => {
      window.location.href = `marketplace-item.html?id=${id}`; // later: marketplace-edit.html
    };

    window.deleteListing = (id) => {
      if (!confirm("Delete this listing?")) return;
      core.deleteListing(id);
      window.location.reload();
    };
  });
</script>

</body>
</html>
