<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Listing ‚Äî Roll ‚Äôn Connect</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="rc_global.css">
</head>
<body>

<div class="stars1"></div><div class="stars2"></div><div class="stars3"></div>

<div class="hamburger" id="hamburger"><span></span><span></span><span></span></div>
<div class="sidebar" id="sidebar">
  <h2>Menu</h2>
  <a href="index.html">Home</a>
  <a href="marketplace.html">Marketplace</a>
  <a href="chatrooms.html">Messages</a>
  <a href="profile.html">Your Profile</a>
</div>

<div class="wrapper" style="padding:24px;">
  <div class="glass" style="padding:24px;">
    <a href="marketplace.html" style="font-size:13px;opacity:0.8;">‚Üê Back to marketplace</a>

    <div class="flex-wrap" style="margin-top:16px;gap:24px;display:flex;flex-wrap:wrap;">
      <div style="flex:1 1 280px;min-width:260px;">
        <div id="photoGallery"></div>
      </div>

      <div style="flex:1 1 280px;min-width:260px;">
        <h1 id="itemTitle" class="section-title"></h1>
        <p id="itemMeta" style="opacity:0.8;"></p>
        <p id="itemPrice" style="font-weight:600;margin-top:8px;"></p>

        <p id="itemDescription" style="margin-top:16px;"></p>
        <div id="itemTags" style="margin-top:10px;"></div>

        <div id="itemSpotLink" style="margin-top:14px;"></div>

        <div id="itemSeller" style="margin-top:18px;"></div>

        <div style="margin-top:18px;display:flex;gap:8px;flex-wrap:wrap;">
          <button class="btn-primary" id="btnMessageSeller">Message Seller</button>
          <button class="btn-secondary" id="btnSaveListing">Save</button>
        </div>
      </div>
    </div>
  </div>
</div>

<script src="rc_core.js"></script>
<script src="js/rc_market_core.js"></script>
<script>
  document.getElementById("hamburger").onclick = () => {
    document.getElementById("hamburger").classList.toggle("active");
    document.getElementById("sidebar").classList.toggle("open");
  };

  document.addEventListener("DOMContentLoaded", () => {
    const core = window.RC_MARKET_CORE;
    const id = core.getQueryParam("id");
    const item = core.getListingById(id);

    const titleEl = document.getElementById("itemTitle");
    const metaEl = document.getElementById("itemMeta");
    const priceEl = document.getElementById("itemPrice");
    const descEl = document.getElementById("itemDescription");
    const tagsEl = document.getElementById("itemTags");
    const spotEl = document.getElementById("itemSpotLink");
    const sellerEl = document.getElementById("itemSeller");
    const galleryEl = document.getElementById("photoGallery");
    const btnMsg = document.getElementById("btnMessageSeller");
    const btnSave = document.getElementById("btnSaveListing");

    if (!item) {
      titleEl.textContent = "Listing not found";
      return;
    }

    titleEl.textContent = item.title;
    metaEl.textContent = `${item.category}${item.spotName ? " ‚Ä¢ " + item.spotName : ""}`;
    priceEl.textContent = core.formatPrice(item.price, item.currency);
    descEl.textContent = item.description || "";
    tagsEl.innerHTML = (item.tags || []).map(t => `<span class="market-tag">${t}</span>`).join("");

    if (item.spotId && item.spotName) {
      spotEl.innerHTML = `
        <button class="btn-small" onclick="window.location.href='find-spots.html?spot=${item.spotId}'">
          üìç View on map: ${item.spotName}
        </button>
      `;
    }

    const seller = core.getUserById(item.sellerId);
    if (seller) {
      sellerEl.innerHTML = `
        <div style="font-size:14px;">
          Sold by
          <a href="marketplace-seller.html?id=${seller.id}" style="color:#fff;text-decoration:underline;">
            ${seller.name}
          </a>
          ${seller.city ? " ‚Ä¢ " + seller.city : ""}
        </div>
      `;
    }

    renderGallery(item);

    function renderGallery(item) {
      const photos = item.photos || [];
      if (!photos.length) {
        galleryEl.innerHTML = `
          <div style="width:100%;height:260px;border-radius:16px;background:rgba(255,255,255,0.06);display:flex;align-items:center;justify-content:center;font-size:40px;opacity:0.6;">
            üõº
          </div>
        `;
        return;
      }

      galleryEl.innerHTML = `
        <div style="width:100%;height:260px;border-radius:16px;overflow:hidden;margin-bottom:8px;">
          <img id="galleryMain" src="${photos[0]}" style="width:100%;height:100%;object-fit:cover;">
        </div>
        <div style="display:flex;gap:6px;flex-wrap:wrap;">
          ${photos.map((p, idx) => `
            <div style="width:60px;height:60px;border-radius:10px;overflow:hidden;cursor:pointer;border:1px solid rgba(255,255,255,0.2);" onclick="document.getElementById('galleryMain').src='${p}'">
              <img src="${p}" style="width:100%;height:100%;object-fit:cover;">
            </div>
          `).join("")}
        </div>
      `;
    }

    function updateSaveButton() {
      btnSave.textContent = core.isSaved(item.id) ? "Saved" : "Save";
    }

    btnSave.onclick = () => {
      core.toggleSaved(item.id);
      updateSaveButton();
    };
    updateSaveButton();

    btnMsg.onclick = () => {
      window.location.href = `chatroom.html?user=${item.sellerId}&item=${item.id}`;
    };
  });
</script>

</body>
</html>
