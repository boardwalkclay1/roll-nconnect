<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Find Spots ‚Äî Roll ‚Äôn Connect</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <link rel="stylesheet" href="rc_global.css">
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

  <style>
    body {
      background:#000;
      color:#fff;
      font-family:'Inter',sans-serif;
      margin:0;
      padding:0;
      overflow:hidden;
    }

    .layout {
      display:grid;
      grid-template-columns:minmax(0,3fr) minmax(0,1.4fr);
      height:100vh;
    }
    @media(max-width:900px){
      .layout {
        grid-template-columns:1fr;
        grid-template-rows:minmax(0,2.5fr) minmax(0,2fr);
      }
    }

    /* MAP */
    .map-shell {
      position:relative;
      overflow:hidden;
    }
    #map {
      width:100%;
      height:100%;
      z-index:1;
    }

    /* FILTER CHIPS */
    .rc-chip {
      padding:8px 14px;
      border-radius:999px;
      background:rgba(255,255,255,0.12);
      backdrop-filter:blur(10px);
      border:1px solid rgba(255,255,255,0.25);
      color:#fff;
      font-size:14px;
      cursor:pointer;
      transition:0.25s ease;
    }
    .rc-chip.active {
      background:rgba(255,255,255,0.25);
      box-shadow:0 0 12px rgba(255,255,255,0.4);
    }

    /* FLOATING BUTTONS */
    .floating-btn {
      position:absolute;
      right:20px;
      padding:12px 16px;
      border-radius:999px;
      background:rgba(0,0,0,0.7);
      border:1px solid rgba(255,255,255,0.3);
      color:#fff;
      cursor:pointer;
      z-index:20;
      transition:0.25s ease;
    }
    .floating-btn:hover {
      background:rgba(255,255,255,0.15);
    }

    #btnMyLocation { bottom:160px; }
    #btnNearby { bottom:110px; }
    #btnCheckIn { bottom:60px; }
    #btnAddSpot { bottom:260px; left:20px; right:auto; }
    #btnAddTrail { bottom:210px; left:20px; right:auto; }

    /* INFO CARD */
    .info-card {
      position:absolute;
      bottom:0;
      left:0;
      width:100%;
      background:rgba(0,0,0,0.75);
      border-top:1px solid rgba(255,255,255,0.2);
      backdrop-filter:blur(12px);
      padding:20px;
      z-index:30;
      display:none;
      border-radius:14px 14px 0 0;
    }
    @media(min-width:900px){
      .info-card {
        width:360px;
        right:20px;
        left:auto;
        top:20px;
        bottom:auto;
        border-radius:14px;
      }
    }
    .info-card h2 {
      margin-top:0;
      text-shadow:0 0 10px white;
    }
    .close-info {
      float:right;
      cursor:pointer;
      opacity:0.7;
    }

    /* RIGHT PANEL */
    .side-panel {
      background:rgba(0,0,0,0.9);
      border-left:1px solid rgba(255,255,255,0.15);
      padding:24px;
      overflow-y:auto;
    }
    .spot-meta {
      margin-top:6px;
      font-size:13px;
      opacity:0.8;
    }
    .tag {
      display:inline-block;
      padding:4px 8px;
      border-radius:8px;
      font-size:12px;
      margin-right:6px;
      margin-top:4px;
      background:rgba(255,255,255,0.12);
      backdrop-filter:blur(6px);
    }
  </style>
</head>

<body>

<div class="stars1"></div>
<div class="stars2"></div>
<div class="stars3"></div>

<div class="hamburger" id="hamburger">
  <span></span><span></span><span></span>
</div>

<div class="sidebar" id="sidebar">
  <h2>Menu</h2>
  <a href="index.html">Home</a>
  <a href="dashboard.html">Dashboard</a>
  <a href="events.html">Events</a>
  <a href="find-spots.html">Find Spots</a>
  <a href="chatrooms.html">Chatrooms</a>
  <a href="profile.html">Your Profile</a>
  <a href="profile-edit.html">Edit Profile</a>
</div>

<a href="chatrooms.html" class="bubble" id="bubbleChat">Chat</a>
<a href="events.html" class="bubble" id="bubbleEvents">Events</a>
<a href="dashboard.html" class="bubble" id="bubbleDash">Dashboard</a>
<a href="profile.html" class="bubble" id="bubbleProfile">Profile</a>

<div class="layout">

  <!-- MAP SIDE -->
  <div class="map-shell">
    <div id="map"></div>

    <!-- FILTER CHIPS -->
    <div id="filterBar" style="
      position:absolute;
      top:20px;
      left:50%;
      transform:translateX(-50%);
      display:flex;
      flex-wrap:wrap;
      gap:8px;
      z-index:20;
    ">
      <button class="rc-chip" data-filter="water">üíß Water</button>
      <button class="rc-chip" data-filter="food">üçî Food</button>
      <button class="rc-chip" data-filter="plaza">üè¨ Plazas</button>
      <button class="rc-chip" data-filter="big_lot">üè™ Big Lots</button>
      <button class="rc-chip" data-filter="parking_garage">üÖøÔ∏è Garages</button>
      <button class="rc-chip" data-filter="hospital">üè• Hospitals</button>
      <button class="rc-chip" data-filter="college">üéì Colleges</button>
      <button class="rc-chip" data-filter="rink">‚õ∏ Rinks</button>
      <button class="rc-chip" data-filter="park">üå≥ Parks</button>
      <button class="rc-chip" data-filter="skatepark">üõπ Skateparks</button>
      <button class="rc-chip" data-filter="trail">üõ£Ô∏è Trails</button>
    </div>

    <!-- FLOATING BUTTONS -->
    <div class="floating-btn" id="btnAddSpot">‚ûï Add Spot</div>
    <div class="floating-btn" id="btnAddTrail">üõ£Ô∏è Add Trail</div>
    <div class="floating-btn" id="btnMyLocation">üìç My Location</div>
    <div class="floating-btn" id="btnNearby">üß≠ Nearby Rollers</div>
    <div class="floating-btn" id="btnCheckIn">üìå Check In</div>

    <!-- INFO CARD -->
    <div class="info-card" id="infoCard">
      <span class="close-info" id="closeInfo">‚úñ</span>
      <h2 id="infoName"></h2>
      <p id="infoType"></p>
      <p id="infoAmenities"></p>

      <button class="floating-btn" style="position:relative;right:auto;bottom:auto;margin-top:10px;" id="btnDirections">
        üß≠ Get Directions
      </button>

      <h3 style="margin-top:20px;">People Here Now</h3>
      <div id="infoPeople"></div>

      <h3 style="margin-top:20px;">Reviews</h3>
      <div id="infoReviews"></div>

      <button class="floating-btn" style="position:relative;right:auto;bottom:auto;margin-top:10px;" id="btnLeaveReview">
        ‚≠ê Leave Review
      </button>
    </div>
  </div>

  <!-- LIST SIDE -->
  <div class="side-panel">
    <h1 class="section-title">Find Spots</h1>
    <p style="opacity:0.8;">Search spots, events, sessions, and trails ‚Äî and interact directly with the map.</p>

    <div class="flex-between flex-wrap gap-md" style="margin-top:18px;margin-bottom:18px;">
      <input id="spotSearchInput" class="glass-input" placeholder="Search spots‚Ä¶">
      <input id="spotLocationInput" class="glass-input" placeholder="City or ZIP">
      <input id="spotRadiusInput" class="glass-input" type="number" min="1" max="200" value="25" style="max-width:120px;" placeholder="Miles">
      <button class="btn-primary" id="spotSearchBtn">Search</button>
    </div>

    <h2 class="section-title">Spots</h2>
    <div id="spotsList"></div>
  </div>

</div>

<script src="rc_core.js"></script>
<script src="js/rc_map.js"></script>

<script>
  document.getElementById("hamburger").onclick = () => {
    document.getElementById("hamburger").classList.toggle("active");
    document.getElementById("sidebar").classList.toggle("open");
  };

  async function searchSpots() {
    const keyword = document.getElementById("spotSearchInput").value.trim().toLowerCase();
    const location = document.getElementById("spotLocationInput").value.trim().toLowerCase();

    const spots = await fetch(`/api/spots`).then(r => r.json());

    const filtered = spots.filter(s => {
      const matchesKeyword =
        !keyword ||
        s.name.toLowerCase().includes(keyword) ||
        s.type.toLowerCase().includes(keyword);

      const matchesLocation =
        !location ||
        (s.city || "").toLowerCase().includes(location);

      return matchesKeyword && matchesLocation;
    });

    const el = document.getElementById("spotsList");
    if (!filtered.length) {
      el.innerHTML = "<p style='opacity:0.7;'>No spots found.</p>";
      return;
    }

    el.innerHTML = filtered.map(s => `
      <div class="glass-card" style="margin-bottom:12px;cursor:pointer;"
           onclick="window.RC_MAP && RC_MAP.focusSpot && RC_MAP.focusSpot('${s.spotId}')">
        <strong>${s.name}</strong><br>
        <span style="opacity:0.8;">${s.type} ‚Ä¢ ${s.city || ""}</span>
        <div class="spot-meta">
          ${s.liveSession ? `<span class="tag">üî• Live session</span>` : ""}
          ${s.trails ? `<span class="tag">üõ£Ô∏è Trails</span>` : ""}
        </div>
        <div class="spot-meta">
          ${s.description || ""}
        </div>
      </div>
    `).join("");

    if (window.RC_MAP && RC_MAP.setVisibleSpots) {
      RC_MAP.setVisibleSpots(filtered.map(s => s.spotId));
    }
  }

  document.getElementById("spotSearchBtn").onclick = searchSpots;
  searchSpots();
</script>

</body>
</html>
